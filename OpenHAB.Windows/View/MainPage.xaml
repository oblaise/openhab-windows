<Page x:Class="OpenHAB.Windows.View.MainPage"
	  xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
	  xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
	  xmlns:controls="using:OpenHAB.Windows.Controls"
	  xmlns:converters="using:OpenHAB.Windows.Converters"
	  xmlns:core="using:Microsoft.Xaml.Interactions.Core"
	  xmlns:community="using:Microsoft.Toolkit.Uwp.UI.Controls"
	  xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
	  xmlns:interactivity="using:Microsoft.Xaml.Interactivity"
	  xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
	  xmlns:model="using:OpenHAB.Core.Model"
	  mc:Ignorable="d">
	<Page.Background>
		<ImageBrush ImageSource="/Assets/background.jpg"
					Stretch="UniformToFill" />
	</Page.Background>

	<Page.Resources>
		<Style TargetType="GridViewItem">
			<Setter Property="HorizontalContentAlignment"
					Value="Stretch" />
			<Setter Property="VerticalContentAlignment"
					Value="Stretch" />
		</Style>

		<converters:ObjectToSitemapConverter x:Key="ObjectToSitemapConverter" />
		<converters:BoolToBackgroundColorConverter x:Key="BoolToBackgroundColorConverter" />
		<converters:ZeroToVisibilityConverter x:Key="ZeroToVisibility" />
		<converters:BooleanToVisibilityConverter x:Key="BoolToVisibilityConverter" />

		<DataTemplate x:Key="NavMenuItemTemplate"
					  x:DataType="model:OpenHABSitemap">
			<StackPanel Orientation="Horizontal">
				<Border Width="5"
						HorizontalAlignment="Left"
						VerticalAlignment="Stretch"
						Background="{Binding Source={RelativeSource TemplatedParent}}" />
				<Image x:Name="image"
					   Width="35"
					   Height="35"
					   Source="/Assets/openhab.png" />
				<TextBlock x:Name="textBlock"
						   Margin="16,0,0,0"
						   VerticalAlignment="Center"
						   Foreground="{StaticResource OpenHABMenuColor}"
						   Style="{StaticResource FlyoutPickerTitleTextBlockStyle}"
						   Text="{x:Bind Name, Mode=OneWay}"
						   TextWrapping="Wrap" />
			</StackPanel>
		</DataTemplate>

		<DataTemplate x:Key="NavMenuHeaderTemplate">
			<TextBlock x:Name="textBlock"
					   Margin="5,0,0,10"
					   VerticalAlignment="Center"
					   Style="{StaticResource HeaderText}"
					   Foreground="{StaticResource OpenHABMenuColor}"
					   Text="{Binding }" />
		</DataTemplate>

		<DataTemplate x:Key="WaitListTemplate">
			<StackPanel Orientation="Horizontal"
						Padding="12">
				<ProgressRing IsActive="True"
							  Margin="0,0,12,0"
							  Foreground="{ThemeResource OpenHABMenuColor}" />
				<TextBlock x:Uid="Loading"
						   VerticalAlignment="Center"
						   Foreground="White" />
			</StackPanel>
		</DataTemplate>
	</Page.Resources>

	<Grid>
		<Grid.ColumnDefinitions>
			<ColumnDefinition Width="*" />
			<ColumnDefinition Width="120" />
		</Grid.ColumnDefinitions>
		<SplitView x:Name="SitemapSplitView"
				   Grid.ColumnSpan="2"
				   VerticalContentAlignment="Stretch"
				   CompactPaneLength="0"
				   DisplayMode="CompactOverlay"
				   IsPaneOpen="False"
				   LightDismissOverlayMode="Auto"
				   OpenPaneLength="200">
			<SplitView.Background>
				<SolidColorBrush Opacity="0.2"
								 Color="Black" />
			</SplitView.Background>

			<SplitView.Pane>
				<Grid Background="{StaticResource OpenHABSplitviewBrush}">
					<Grid.RowDefinitions>
						<RowDefinition Height="Auto" />
						<RowDefinition Height="*" />
						<RowDefinition Height="Auto" />
					</Grid.RowDefinitions>
					<controls:NavMenuListView Grid.Row="1"
											  Margin="0,48,0,0"
											  Padding="0"
											  HeaderTemplate="{StaticResource NavMenuHeaderTemplate}"
											  Header="Sitemaps"
											  ItemContainerStyle="{StaticResource NavMenuContainerStyle}"
											  ItemTemplate="{StaticResource NavMenuItemTemplate}"
											  ItemsSource="{x:Bind Vm.Sitemaps, Mode=OneWay}"
											  SelectedItem="{x:Bind Vm.SelectedSitemap, Converter={StaticResource ObjectToSitemapConverter}, Mode=TwoWay}" />
					<TextBlock Grid.Row="1"
							   Margin="10,100,10,0"
							   x:Uid="NoItemsOrOpenHabNotAvailable"
							   Visibility="{x:Bind Vm.Sitemaps.Count, Converter={StaticResource ZeroToVisibility}, Mode=OneWay}"
							   TextWrapping="Wrap"
							   Foreground="{StaticResource OpenHABMenuColor}"
							   Style="{StaticResource FlyoutPickerTitleTextBlockStyle}" />

					<StackPanel Grid.Row="2"
								Orientation="Vertical">
						<StackPanel Margin="12,0,0,15"
									VerticalAlignment="Bottom"
									Orientation="Horizontal">
							<interactivity:Interaction.Behaviors>
								<core:EventTriggerBehavior EventName="Tapped">
									<core:InvokeCommandAction Command="{x:Bind Vm.FeedbackCommand}" />
								</core:EventTriggerBehavior>
							</interactivity:Interaction.Behaviors>
							<TextBlock VerticalAlignment="Center"
									   AutomationProperties.Name="Favorite"
									   FontFamily="Segoe MDL2 Assets"
									   FontSize="36"
									   Foreground="{StaticResource OpenHABMenuColor}"
									   Text="&#xE939;" />
							<TextBlock x:Uid="FeedbackHeader"
									   x:Name="feedbackTextBlock"
									   Margin="12,0,0,0"
									   VerticalAlignment="Center"
									   Foreground="{StaticResource OpenHABMenuColor}"
									   Style="{StaticResource FlyoutPickerTitleTextBlockStyle}"
									   TextWrapping="Wrap" />
						</StackPanel>
						<StackPanel Margin="12,0,0,8"
									VerticalAlignment="Bottom"
									Orientation="Horizontal">
							<interactivity:Interaction.Behaviors>
								<core:EventTriggerBehavior EventName="Tapped">
									<core:NavigateToPageAction TargetPage="OpenHAB.Windows.View.SettingsPage" />
								</core:EventTriggerBehavior>
							</interactivity:Interaction.Behaviors>
							<TextBlock VerticalAlignment="Center"
									   AutomationProperties.Name="Favorite"
									   FontFamily="Segoe MDL2 Assets"
									   FontSize="36"
									   Foreground="{StaticResource OpenHABMenuColor}"
									   Text="&#xE713;" />
							<TextBlock x:Uid="SettingsHeader"
									   x:Name="settingsTextBlock"
									   Margin="12,0,0,0"
									   VerticalAlignment="Center"
									   Foreground="{StaticResource OpenHABMenuColor}"
									   Style="{StaticResource FlyoutPickerTitleTextBlockStyle}"
									   TextWrapping="Wrap" />
						</StackPanel>
					</StackPanel>
				</Grid>
			</SplitView.Pane>
			<Grid x:Name="MainContentGrid"
				  Margin="35,0,0,0"
				  VerticalAlignment="Stretch">
				<Grid.RowDefinitions>
					<RowDefinition Height="Auto" />
					<RowDefinition Height="*" />
				</Grid.RowDefinitions>
				<TextBlock x:Name="SitemapLabel"
						   FontSize="36"
						   Foreground="White"
						   Text="{x:Bind Vm.SelectedSitemap.Label, Mode=OneWay}" />
				<ScrollViewer Grid.Row="1"
							  VerticalScrollBarVisibility="Auto">
					<GridView x:Name="MasterListView"
							  Margin="12,0,0,0"
							  HorizontalAlignment="Stretch"
							  VerticalAlignment="Stretch"
							  HorizontalContentAlignment="Stretch"
							  VerticalContentAlignment="Stretch"
							  IsItemClickEnabled="True"
							  IsTapEnabled="True"
							  ItemClick="MasterListView_OnItemClick"
							  ItemTemplateSelector="{StaticResource WidgetTemplateSelector}"
							  ItemsSource="{x:Bind Vm.CurrentWidgets, Mode=OneWay}"
							  SelectionMode="None">
						<GridView.ItemsPanel>
							<ItemsPanelTemplate>
								<VariableSizedWrapGrid ItemHeight="106"
													   ItemWidth="310"
													   Orientation="Horizontal" />
							</ItemsPanelTemplate>
						</GridView.ItemsPanel>
					</GridView>
				</ScrollViewer>
			</Grid>
		</SplitView>

		<ToggleButton x:Name="TogglePaneButton"
					  Grid.Row="0"
					  Foreground="White"
					  IsChecked="{Binding IsPaneOpen, ElementName=SitemapSplitView, Mode=TwoWay}"
					  Style="{StaticResource SplitViewTogglePaneButtonStyle}"
					  TabIndex="1"
					  ToolTipService.ToolTip="Menu" />

		<community:InAppNotification x:Uid="ErrorMessage"
									 x:Name="ErrorNotification"
									 Grid.Column="0"
									 Grid.ColumnSpan="2"
									 Background="{StaticResource ErrorNotificationBackground}"
									 ShowDismissButton="True"
									 AnimationDuration="00:00:00.1000000"
									 VerticalOffset="100"
									 HorizontalOffset="0"
									 StackMode="Replace" />

		<community:InAppNotification x:Name="InfoNotification"
									 Grid.Column="0"
									 Grid.ColumnSpan="2"
									 Background="{StaticResource NotificationBackground}"
									 ShowDismissButton="True"
									 AnimationDuration="00:00:00.1000000"
									 VerticalOffset="100"
									 HorizontalOffset="0"
									 StackMode="StackInFront" />

		<community:Loading x:Name="LoadingControl"
						   Grid.Column="0"
						   Grid.ColumnSpan="2"
						   IsLoading="{x:Bind Vm.IsDataLoading, Mode=TwoWay}"
						   HorizontalContentAlignment="Center"
						   VerticalContentAlignment="Center">
			<community:Loading.Background>
				<SolidColorBrush Color="Black"
								 Opacity="0.7" />
			</community:Loading.Background>
			<ContentControl x:Name="LoadingContentControl"
							ContentTemplate="{StaticResource WaitListTemplate}" />
		</community:Loading>

		<VisualStateManager.VisualStateGroups>
			<VisualStateGroup x:Name="WindowStates">
				<VisualState x:Name="WideState">
					<VisualState.StateTriggers>
						<AdaptiveTrigger MinWindowWidth="720" />
					</VisualState.StateTriggers>
					<VisualState.Setters>
						<Setter Target="SitemapSplitView.CompactPaneLength"
								Value="56" />
						<Setter Target="SitemapLabel.Margin"
								Value="20,12,0,16" />
						<Setter Target="SitemapSplitView.DisplayMode"
								Value="Inline" />
						<Setter Target="SitemapSplitView.IsPaneOpen"
								Value="True" />
					</VisualState.Setters>
				</VisualState>
				<VisualState x:Name="NarrowState">
					<VisualState.StateTriggers>
						<AdaptiveTrigger MinWindowWidth="0" />
					</VisualState.StateTriggers>
					<VisualState.Setters>
						<Setter Target="SitemapSplitView.CompactPaneLength"
								Value="0" />
						<Setter Target="SitemapLabel.Margin"
								Value="40,12,0,16" />
						<Setter Target="SitemapSplitView.DisplayMode"
								Value="CompactOverlay" />
						<Setter Target="SitemapSplitView.IsPaneOpen"
								Value="False" />
					</VisualState.Setters>
				</VisualState>
			</VisualStateGroup>
		</VisualStateManager.VisualStateGroups>
	</Grid>
</Page>